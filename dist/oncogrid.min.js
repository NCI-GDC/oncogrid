!function t(e,r,n){function o(i,s){if(!r[i]){if(!e[i]){var d="function"==typeof require&&require;if(!s&&d)return d(i,!0);if(a)return a(i,!0);throw new Error("Cannot find module '"+i+"'")}var c=r[i]={exports:{}};e[i][0].call(c.exports,function(t){var r=e[i][1][t];return o(r?r:t)},c,c.exports,t,e,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(t,e,r){"use strict";var n;n=function(t,e,r){var n=this;n.prefix=t.prefix||"og-",n.observations=t.observations,n.svg=e,n.rotated=r||!1,n.domain=(n.rotated?t.genes:t.donors)||[],n.margin=t.margin||{top:30,right:15,bottom:15,left:80},n.width=t.width||500,n.height=t.height||500,n.histogramWidth=n.rotated?n.height:n.width,n.histogramHeight=80,n.numDomain=n.domain.length,n.barWidth=(n.rotated?n.height:n.width)/n.domain.length},n.prototype.render=function(t,e){function r(){for(var t=1,e=0;e<n.domain.length;e++){var r=n.domain[e];t=Math.max(t,r.count)}return t}var n=this;n.x=t,n.div=e;var o=r();n.histogram=n.svg.append("g").attr("class",n.prefix+"histogram").attr("width",function(){return n.rotated?n.height:n.width+n.margin.left+n.margin.right}).attr("height",n.histogramHeight).style("margin-left",n.margin.left+"px").attr("transform",function(){return n.rotated?"rotate(90)translate(0,-"+n.width+")":""}).append("g").attr("transform","translate(0,-"+(n.histogramHeight+n.margin.top/1.61803398875)+")"),n.renderAxis(o),n.histogram.selectAll("rect").data(n.domain).enter().append("rect").on("mouseover",function(t){n.div.transition().duration(200).style("opacity",.9),n.div.html("ID: "+t.id+"<br/> Count:"+t.count+"<br/>").style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){n.div.transition().duration(500).style("opacity",0)}).on("click",n.clickFunc).transition().attr("class",function(t){return n.prefix+"sortable-bar "+t.id+"-bar"}).attr("width",n.barWidth-1).attr("height",function(t){return n.histogramHeight*t.count/o}).attr("x",function(t){return n.x(n.getIndex(n.domain,t.id))}).attr("y",function(t){return n.histogramHeight-n.histogramHeight*t.count/o}).attr("fill","#1693C0")},n.prototype.update=function(t,e){var r=this;r.x=e,r.domain=t,r.barWidth=(r.rotated?r.height:r.width)/r.domain.length,r.histogram.selectAll("rect").transition().attr("width",r.barWidth-1).attr("x",function(t){return r.x(r.getIndex(r.domain,t.id))})},n.prototype.renderAxis=function(t){var e=this;e.histogram.append("line").attr("class",e.prefix+"histogram-axis").attr("y1",e.histogramHeight+5).attr("y2",e.histogramHeight+5).attr("x2",e.histogramWidth+10).attr("transform","translate(-5,0)"),e.histogram.append("line").attr("class",e.prefix+"histogram-axis").attr("y1",0).attr("y2",e.histogramHeight+5).attr("transform","translate(-5,0)"),e.histogram.append("text").attr("class",e.prefix+"label-text-font").attr("x",-6).attr("dy",".32em").attr("text-anchor","end").text(t);var r=parseInt(t/2),n=e.histogramHeight-e.histogramHeight/(t/r);e.histogram.append("text").attr("class",e.prefix+"label-text-font").attr("x",-6).attr("y",n).attr("dy",".32em").attr("text-anchor","end").text(r),e.histogram.append("text").attr("class",e.prefix+"label-text-font").attr("dy",".32em").attr("text-anchor","end").attr("transform","rotate(-90)translate("+n/-2+",-25)").text("Mutation freq.")},n.prototype.getIndex=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(n.id===e)return r}return-1},e.exports=n},{}],2:[function(t,e,r){"use strict";var n,o=t("./Histogram"),a=t("./Track");n=function(t,e){var r=this;r.updateCallback=e,r.loadParams(t),r.init(),r.donorHistogram=new o(t,r.svg,!1),r.donorTrack=new a(t,r.svg,!1,t.donorTracks,t.donorOpacityFunc,t.donorFillFunc),r.donorTrack.init(),r.geneHistogram=new o(t,r.svg,!0),r.geneTrack=new a(t,r.svg,!0,t.geneTracks,t.geneOpacityFunc,t.donorFillFunc),r.geneTrack.init()},n.prototype.loadParams=function(t){var e=this;e.prefix=t.prefix||"og-",e.minCellHeight=t.minCellHeight||8,e.donors=t.donors||[],e.genes=t.genes||[],e.observations=t.observations||[],e.element=t.element||"body",e.colorMap=t.colorMap||{missense_variant:"#ff825a",frameshift_variant:"#57dba4",stop_gained:"#af57db",start_lost:"#af57db",stop_lost:"#ffe",initiator_codon_variant:"#af57db"},e.numDonors=e.donors.length,e.numGenes=e.genes.length,e.width=t.width||500,e.height=t.height||500,e.cellWidth=e.width/e.donors.length,e.cellHeight=e.height/e.genes.length,e.cellHeight<10&&(e.cellHeight=10,t.height=e.numGenes*e.minCellHeight,e.height=t.height),e.margin=t.margin||{top:30,right:100,bottom:15,left:80},e.heatMap=t.heatMap,e.histogramHeight=100,e.drawGridLines=!1,e.crosshair=!0,e.gridClick=t.gridClick},n.prototype.init=function(){var t=this;t.div=d3.select(t.element).append("div").attr("class",t.prefix+"tooltip-oncogrid").style("opacity",0),t.svg=d3.select(t.element).append("svg").attr("class",t.prefix+"maingrid-svg").attr("width",t.width+t.margin.left+t.margin.right+2*t.histogramHeight).attr("height",t.height+t.margin.top+t.margin.bottom+2*t.histogramHeight).style("margin-left",t.margin.left+"px").append("g").attr("transform","translate("+t.margin.left+","+(t.margin.top+t.histogramHeight)+")"),t.svg.append("rect").attr("class","background").attr("width",t.width).attr("height",t.height)},n.prototype.render=function(){var t=this;t.computeCoordinates(),t.svg.selectAll("."+t.prefix+"maingrid-svg").data(t.observations).enter().append("rect").on("mouseover",function(e){t.div.transition().duration(200).style("opacity",.9),t.div.html(e.id+"<br/>"+e.geneId+"<br/>"+e.donorId+"<br/>"+e.consequence).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(e){t.div.transition().duration(500).style("opacity",0)}).on("click",function(e){"undefined"!=typeof t.gridClick&&t.gridClick(e)}).transition().attr("class",function(e){return t.prefix+"sortable-rect "+e.donorId+"-cell "+e.geneId+"-cell"}).attr("cons",function(t){return t.consequence}).attr("x",function(e){return t.x(t.getDonorIndex(t.donors,e.donorId))}).attr("y",function(e){return t.getY(e)}).attr("width",t.cellWidth).attr("height",function(e){return t.getHeight(e)}).attr("fill",function(e){return t.getColor(e)}).attr("opacity",function(e){return t.getOpacity(e)}).attr("stroke-width",2),t.donorHistogram.render(t.x,t.div),t.donorTrack.render(t.x),t.geneHistogram.render(t.y,t.div),t.geneTrack.render(t.y),t.defineCrosshairBehaviour()},n.prototype.update=function(){var t=this;(t.numDonors!==t.donors.length||t.numGenes!==t.genes.length)&&(t.numDonors=t.donors.length,t.numGenes=t.genes.length,t.cellWidth=t.width/t.numDonors,t.cellHeight=t.height/t.numGenes,t.computeCoordinates()),t.row.transition().attr("transform",function(e){return"translate( 0, "+t.y(t.genes.indexOf(e))+")"}),t.svg.selectAll("."+t.prefix+"sortable-rect").transition().attr("width",t.cellWidth).attr("height",t.getHeight()).attr("y",function(e){return t.getY(e)}).attr("x",function(e){return t.x(t.getDonorIndex(t.donors,e.donorId))}),t.donorHistogram.update(t.donors,t.x),t.donorTrack.update(t.donors,t.x),t.geneHistogram.update(t.genes,t.y),t.geneTrack.update(t.genes,t.y)},n.prototype.computeCoordinates=function(){var t=this;t.x=d3.scale.ordinal().domain(d3.range(t.donors.length)).rangeBands([0,t.width]),t.cellWidth=t.width/t.donors.length,"undefined"!=typeof t.column&&t.column.remove(),t.column=t.svg.selectAll("."+t.prefix+"donor-column").data(t.donors).enter().append("g").attr("class",t.prefix+"donor-column").attr("donor",function(t){return t.id}).attr("transform",function(e,r){return"translate("+t.x(r)+")rotate(-90)"}),t.drawGridLines&&t.column.append("line").attr("x1",-t.height),t.y=d3.scale.ordinal().domain(d3.range(t.genes.length)).rangeBands([0,t.height]),t.cellHeight=t.height/t.genes.length,"undefined"!=typeof t.row&&t.row.remove(),t.row=t.svg.selectAll("."+t.prefix+"gene-row").data(t.genes).enter().append("g").attr("class",t.prefix+"gene-row").attr("transform",function(e,r){return"translate(0,"+t.y(r)+")"}),t.drawGridLines&&t.row.append("line").attr("x2",t.width),t.row.append("text").attr("class",function(e){return e.id+"-label "+t.prefix+"gene-label "+t.prefix+"label-text-font"}).transition().attr("x",-8).attr("y",t.cellHeight/2).attr("dy",".32em").attr("text-anchor","end").text(function(e,r){return t.genes[r].symbol}),t.defineRowDragBehaviour()},n.prototype.defineCrosshairBehaviour=function(){var t=this;t.verticalCross=t.svg.append("line").attr("class",t.prefix+"vertical-cross").attr("stroke","orange").attr("y1",0).attr("y2",t.height),t.horizontalCross=t.svg.append("line").attr("class",t.prefix+"horizontal-cross").attr("stroke","black").attr("x1",0).attr("x2",t.width),t.svg.on("mouseover",function(){var e=d3.mouse(this);t.verticalCross.attr("x1",e[0]),t.verticalCross.attr("x2",e[0]),t.horizontalCross.attr("y1",e[1]),t.horizontalCross.attr("y2",d3.event.pageY);var r=t.rangeToDomain(t.x,e[0]),n=t.rangeToDomain(t.y,e[1]);t.div.transition().duration(200).style("opacity",.9),t.div.html("Donor: "+t.donors[r].id+"</br>Gene: "+t.genes[n].id).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-28+"px")}).on("mousemove",function(){var e=d3.mouse(this);t.verticalCross.attr("x1",e[0]),t.verticalCross.attr("x2",e[0]),t.horizontalCross.attr("y1",e[1]),t.horizontalCross.attr("y2",e[1]);var r=t.rangeToDomain(t.x,e[0]),n=t.rangeToDomain(t.y,e[1]);t.div.html("Donor: "+t.donors[r].id+"</br>Gene: "+t.genes[n].id).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){t.div.transition().duration(500).style("opacity",0)})},n.prototype.defineRowDragBehaviour=function(){var t=this,e=d3.behavior.drag();e.on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}),e.on("drag",function(e){var r=d3.event.dy,n=t.genes.indexOf(e),o=d3.select(this);o.attr("transform",function(){var t=d3.transform(d3.select(this).attr("transform"));return"translate( 0, "+(parseInt(t.translate[1])+r)+")"});var a=d3.transform(d3.select(this).attr("transform")).translate[1];t.row.each(function(e){var o,i,s=t.genes.indexOf(e);r>0&&s>n?(i=d3.transform(d3.select(this).attr("transform")).translate[1],a>i&&(o=t.genes[n],t.genes[n]=t.genes[s],t.genes[s]=o)):0>r&&n>s&&(i=d3.transform(d3.select(this).attr("transform")).translate[1],i>a&&(o=t.genes[n],t.genes[n]=t.genes[s],t.genes[s]=o))})}),e.on("dragend",function(){t.updateCallback(!0)});var r=t.row.call(e);r.on("click",function(){d3.event.defaultPrevented}),t.row.on("mouseover",function(){var e=this;"undefined"!=typeof e.timeout&&clearTimeout(e.timeout),d3.select(this).select("."+t.prefix+"remove-gene").attr("style","display: block")}),t.row.on("mouseout",function(){var e=this;e.timeout=setTimeout(function(){d3.select(e).select("."+t.prefix+"remove-gene").attr("style","display: none")},500)})},n.prototype.getY=function(t){var e=this,r=e.genes.map(function(t){return t.id});if(e.heatMap===!0)return e.y(r.indexOf(t.geneId));var n=Object.keys(e.colorMap);return e.y(r.indexOf(t.geneId))+e.cellHeight/n.length*n.indexOf(t.consequence)},n.prototype.getColor=function(t){var e=this;return e.heatMap===!0?"#D33682":e.colorMap[t.consequence]},n.prototype.getOpacity=function(){var t=this;return t.heatMap===!0?.3:1},n.prototype.getHeight=function(){var t=this;return t.heatMap===!0?t.cellHeight:t.cellHeight/Object.keys(t.colorMap).length},n.prototype.toggleHeatmap=function(){var t=this;t.heatMap=t.heatMap!==!0,d3.selectAll("."+t.prefix+"sortable-rect").transition().attr("y",function(e){return t.getY(e)}).attr("height",function(e){return t.getHeight(e)}).attr("fill",function(e){return t.getColor(e)}).attr("opacity",function(e){return t.getOpacity(e)})},n.prototype.toggleGridLines=function(){var t=this;t.drawGridLines?t.drawGridLines=!1:t.drawGridLines=!0,t.geneTrack.toggleGridLines(),t.donorTrack.toggleGridLines(),t.computeCoordinates()},n.prototype.toggleCrosshair=function(){var t=this;t.crosshair?t.crosshair=!1:t.crosshair=!0},n.prototype.getDonorIndex=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(n.id===e)return r}return-1},n.prototype.removeGene=function(t){var e=this,r=e.genes[t];r&&(d3.selectAll("."+r.id+"-cell").remove(),d3.selectAll("."+r.id+"-bar").remove(),e.genes.splice(t,1)),e.updateCallback(!0)},n.prototype.rangeToDomain=function(t,e){return t.domain()[d3.bisect(t.range(),e)-1]},n.prototype.destroy=function(){var t=this;d3.select(t.element).select("."+t.prefix+"maingrid-svg").remove(),d3.select(t.element).select("."+t.prefix+"tooltip-oncogrid").remove()},e.exports=n},{"./Histogram":1,"./Track":4}],3:[function(t,e,r){"use strict";var n,o=t("./MainGrid");n=function(t){var e=this;e.donors=t.donors||[],e.genes=t.genes||[],e.observations=t.observations||[],e.createLookupTable(),e.computeDonorCounts(),e.computeGeneCounts(),e.computeGeneScores(),e.genesSortbyScores(),e.computeScores(),e.sortByScores(),e.mainGrid=new o(t,e.update(e)),e.charts=[],e.charts.push(e.mainGrid)},n.prototype.createLookupTable=function(){for(var t=this,e={},r=0;r<t.observations.length;r++){var n=t.observations[r],o=n.donorId,a=n.geneId;e.hasOwnProperty(o)?e[o].hasOwnProperty(a)?e[o][a].push(n.id):e[o][a]=[n.id]:(e[o]={},e[o][a]=[n.id]),t.lookupTable=e}},n.prototype.render=function(){var t=this;t.charts.forEach(function(t){t.render()})},n.prototype.update=function(t){var e=t;return function(t){t="undefined"==typeof t||null===t?!1:t,t&&(e.computeScores(),e.sortByScores()),e.charts.forEach(function(t){t.update()})}},n.prototype.sortByScores=function(){var t=this;t.donors.sort(t.sortScore)},n.prototype.genesSortbyScores=function(){var t=this;t.genes.sort(t.sortScore)},n.prototype.getDonorIndex=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(n.id===e)return r}return-1},n.prototype.cluster=function(){var t=this;t.genesSortbyScores(),t.computeScores(),t.sortByScores(),t.update(t)()},n.prototype.removeDonors=function(t){for(var e=this,r=[],n=0;n<e.donors.length;n++){var o=e.donors[n];t(o)&&(r.push(o.id),d3.selectAll("."+o.id+"-cell").remove(),d3.selectAll("."+o.id+"-bar").remove(),e.donors.splice(n,1),n--)}for(var a=0;a<e.observations.length;a++){var i=e.observations[a];e.donors.indexOf(i.id)>=0&&(e.observations.splice(a,1),a--)}e.computeGeneScores(),e.update(e)()},n.prototype.removeGenes=function(t){for(var e=this,r=[],n=0;n<e.genes.length;n++){var o=e.genes[n];t(o)&&(r.push(o.id),d3.selectAll("."+o.id+"-cell").remove(),d3.selectAll("."+o.id+"-bar").remove(),e.genes.splice(n,1),n--)}e.update(e)()},n.prototype.sortDonors=function(t){var e=this;e.donors.sort(t),e.update(e)()},n.prototype.sortGenes=function(t){var e=this;e.computeScores(),e.sortByScores(),e.genes.sort(t),e.update(e)()},n.prototype.toggleHeatmap=function(){var t=this;t.mainGrid.toggleHeatmap()},n.prototype.toggleGridLines=function(){var t=this;t.mainGrid.toggleGridLines()},n.prototype.mutationScore=function(t,e){var r=this;return r.lookupTable.hasOwnProperty(t)&&r.lookupTable[t].hasOwnProperty(e)?1:0},n.prototype.mutationGeneScore=function(t,e){var r=this;return r.lookupTable.hasOwnProperty(t)&&r.lookupTable[t].hasOwnProperty(e)?r.lookupTable[t][e].length:0},n.prototype.computeScores=function(){for(var t=this,e=0;e<t.donors.length;e++){var r=t.donors[e];r.score=0;for(var n=0;n<t.genes.length;n++){var o=t.genes[n];r.score+=t.mutationScore(r.id,o.id)*Math.pow(2,t.genes.length+1-n)}}},n.prototype.computeGeneScores=function(){for(var t=this,e=0;e<t.genes.length;e++){var r=t.genes[e];r.score=0;for(var n=0;n<t.donors.length;n++){var o=t.donors[n];r.score+=t.mutationGeneScore(o.id,r.id)}}},n.prototype.computeDonorCounts=function(){for(var t=this,e=0;e<t.donors.length;e++){var r=t.donors[e];r.count=0;for(var n=0;n<t.observations.length;n++){var o=t.observations[n];r.id===o.donorId&&(r.count+=1)}}},n.prototype.computeGeneCounts=function(){for(var t=this,e=0;e<t.genes.length;e++){var r=t.genes[e];r.count=0;for(var n=0;n<t.observations.length;n++){var o=t.observations[n];r.id===o.geneId&&(r.count+=1)}}},n.prototype.sortScore=function(t,e){return t.score<e.score?1:t.score>e.score?-1:0},n.prototype.destroy=function(){var t=this;t.charts.forEach(function(t){t.destroy()})},e.exports=n},{"./MainGrid":2}],4:[function(t,e,r){"use strict";var n;n=function(t,e,r,n,o,a){var i=this;i.prefix=t.prefix||"og-",i.svg=e,i.rotated=r||!1,i.margin=t.margin||{top:30,right:15,bottom:15,left:80},i.domain=(i.rotated?t.genes:t.donors)||[],i.width=(i.rotated?t.height:t.width)||500,i.cellHeight=t.trackHeight||20,i.numDomain=i.domain.length,i.cellWidth=i.width/i.numDomain,i.availableTracks=n||[],i.opacityFunc=o,i.fillFunc=a,i.translateDown=(i.rotated?-1*(t.width+150+i.availableTracks.length*i.cellHeight):t.height)||500,i.height=i.cellHeight*i.availableTracks.length,i.drawGridLines=!1},n.prototype.init=function(){var t=this;t.trackData=[];for(var e=0;e<t.domain.length;e++)for(var r=0;r<t.availableTracks.length;r++)t.trackData.push({id:t.domain[e].id,value:t.domain[e][t.availableTracks[r].fieldName],fieldName:t.availableTracks[r].fieldName,type:t.availableTracks[r].type});t.track=t.svg.append("g").attr("width",t.width).attr("height",t.height).attr("class",t.prefix+"track").attr("transform",function(){return t.rotated?"rotate(90)":""}).append("g").attr("transform","translate(0,"+(t.translateDown+t.margin.top/1.61803398875)+")"),t.track.append("rect").attr("class","background").attr("width",t.width).attr("height",t.height)},n.prototype.render=function(t){var e=this;e.x=t,e.computeCoordinates(),e.track.selectAll("."+e.prefix+"track").data(e.trackData).enter().append("rect").transition().attr("class",function(t){return e.prefix+"track-data "+e.prefix+"track-"+t.fieldName+" "+e.prefix+"track-"+t.value+" "+t.id+"-cell"}).attr("x",function(t){return e.getX(t)}).attr("y",function(t){return e.getY(t)}).attr("width",e.cellWidth).attr("height",e.cellHeight).attr("fill",e.fillFunc).attr("opacity",e.opacityFunc)},n.prototype.update=function(t,e){var r=this;r.domain=t,r.x=e,r.domain.length!==r.numDomain&&(r.numDomain=r.domain.length,r.computeCoordinates(),r.cellWidth=r.width/r.numDomain),r.track.selectAll("."+r.prefix+"track-data").transition().attr("x",function(t){return r.getX(t)}).attr("width",r.cellWidth)},n.prototype.getX=function(t){var e=this,r=e.domain.map(function(t){return t.id});return e.x(r.indexOf(t.id))},n.prototype.getY=function(t){var e=this,r=e.availableTracks.map(function(t){return t.fieldName});return e.y(r.indexOf(t.fieldName))},n.prototype.computeCoordinates=function(){var t=this;"undefined"!=typeof t.column&&t.column.remove(),t.column=t.track.selectAll("."+t.prefix+"column").data(t.domain).enter().append("g").attr("class",t.prefix+"column").attr("donor",function(t){return t.id}).attr("transform",function(e,r){return"translate("+t.x(r)+")rotate(-90)"}),t.drawGridLines&&t.column.append("line").attr("x1",-t.height),t.y=d3.scale.ordinal().domain(d3.range(t.availableTracks.length)).rangeBands([0,t.height]),"undefined"!=typeof t.row&&t.row.remove(),t.row=t.track.selectAll("."+t.prefix+"row").data(t.availableTracks).enter().append("g").attr("class",t.prefix+"row").attr("transform",function(e,r){return"translate(0,"+t.y(r)+")"}),t.drawGridLines&&t.row.append("line").attr("x2",t.width),t.row.append("text").attr("class",t.prefix+"gene-label "+t.prefix+"label-text-font").transition().attr("x",-6).attr("y",t.cellHeight/2).attr("dy",".32em").attr("text-anchor","end").text(function(e,r){return t.availableTracks[r].name})},n.prototype.toggleGridLines=function(){var t=this;t.drawGridLines?t.drawGridLines=!1:t.drawGridLines=!0,t.computeCoordinates()},e.exports=n},{}],5:[function(t,e,r){"use strict";window.OncoGrid=t("./OncoGrid")},{"./OncoGrid":3}]},{},[5]);