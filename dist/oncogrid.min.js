!function t(e,n,r){function o(s,i){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!i&&c)return c(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'")}var d=n[s]={exports:{}};e[s][0].call(d.exports,function(t){var n=e[s][1][t];return o(n?n:t)},d,d.exports,t,e,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){var r;!function(){"use strict";r=function(t){var e=this;e.observations=t.observations,e.domain=t.domain}}(),e.exports=r},{}],2:[function(t,e,n){var r;!function(){"use strict";r=function(t,e){var n=this;n.donors=t.donors||[],n.genes=t.genes||[],n.observations=t.observations||[],n.element=t.element||"body",n.colorMap=t.colorMap||{missense_variant:"#ff825a",frameshift_variant:"#57dba4",stop_gained:"#af57db",start_lost:"#af57db",stop_lost:"#ffe",initiator_codon_variant:"#af57db"},n.width=t.width||500,n.height=t.height||500,n.margin=t.margin||{top:10,right:15,bottom:15,left:80},n.numDonors=n.donors.length,n.numGenes=n.genes.length,n.cellWidth=n.width/n.donors.length,n.cellHeight=n.height/n.genes.length,n.heatMap=t.heatMap,n.updateCallback=e,n.init()},r.prototype.init=function(){var t=this;t.div=d3.select(t.element).append("div").attr("class","tooltip-oncogrid").style("opacity",0),t.svg=d3.select(t.element).append("svg").attr("class","maingrid-svg").attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom).style("margin-left",t.margin.left+"px").append("g").attr("transform","translate("+t.margin.left+","+t.margin.top+")"),t.svg.append("rect").attr("class","background").attr("width",t.width).attr("height",t.height)},r.prototype.render=function(){var t=this;t.computeCoordinates(),t.row.append("text").attr("class","gene-label label-text-font").transition().attr("x",-6).attr("y",t.cellHeight/2).attr("dy",".32em").attr("text-anchor","end").text(function(e,n){return t.genes[n].symbol}),t.defineRowDragBehaviour(),t.svg.selectAll("svg").data(t.observations).enter().append("rect").on("mouseover",function(e){t.div.transition().duration(200).style("opacity",.9),t.div.html(e.donorId+"<br/>"+e.gene+"<br/>"+e.id).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){t.div.transition().duration(500).style("opacity",0)}).on("click",function(t){}).transition().attr("class",function(t){return"sortable-rect "+t.donorId+"-cell "+t.gene+"-cell"}).attr("cons",function(t){return t.consequence}).attr("x",function(e){return t.x(t.getDonorIndex(t.donors,e.donorId))}).attr("y",function(e){return t.getY(e)}).attr("width",t.cellWidth).attr("height",function(e){return t.getHeight(e)}).attr("fill",function(e){return t.getColor(e)}).attr("opacity",function(e){return t.getOpacity(e)}).attr("stroke-width",2)},r.prototype.update=function(){var t=this;(t.numDonors!==t.donors.length||t.numGenes!==t.genes.length)&&(t.numDonors=t.donors.length,t.numGenes=t.genes.length,t.computeCoordinates()),d3.selectAll(".row").transition().attr("transform",function(e){return"translate( 0, "+t.y(t.genes.indexOf(e))+")"}),d3.selectAll(".sortable-rect").transition().attr("y",function(e){return t.getY(e)}).attr("x",function(e){return t.x(t.getDonorIndex(t.donors,e.donorId))})},r.prototype.computeCoordinates=function(){var t=this;t.x=d3.scale.ordinal().domain(d3.range(t.donors.length)).rangeBands([0,t.width]),t.cellWidth=t.width/t.donors.length,"undefined"!=typeof t.column&&t.column.remove(),t.column=t.svg.selectAll(".column").data(t.donors).enter().append("g").attr("class","column").attr("donor",function(t){return t.donorId}).attr("transform",function(e,n){return"translate("+t.x(n)+")rotate(-90)"}),t.column.append("line").attr("x1",-t.width),t.y=d3.scale.ordinal().domain(d3.range(t.genes.length)).rangeBands([0,t.height]),t.cellHeight=t.height/t.genes.length,"undefined"!=typeof t.row&&t.row.remove(),t.row=t.svg.selectAll(".row").data(t.genes).enter().append("g").attr("class","row").attr("transform",function(e,n){return"translate(0,"+t.y(n)+")"}),t.row.append("line").attr("x2",t.width),t.row.append("text").attr("class","gene-label label-text-font").transition().attr("x",-6).attr("y",t.cellHeight/2).attr("dy",".32em").attr("text-anchor","end").text(function(e,n){return t.genes[n].symbol}),t.defineRowDragBehaviour()},r.prototype.defineRowDragBehaviour=function(){var t=this,e=d3.behavior.drag();e.on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}),e.on("drag",function(e){var n=d3.event.dy,r=t.genes.indexOf(e),o=d3.select(this);o.attr("transform",function(){var t=d3.transform(d3.select(this).attr("transform"));return"translate( 0, "+(parseInt(t.translate[1])+n)+")"});var a=d3.transform(d3.select(this).attr("transform")).translate[1];d3.selectAll(".row").each(function(e){var o,s,i=t.genes.indexOf(e);n>0&&i>r?(s=d3.transform(d3.select(this).attr("transform")).translate[1],a>s&&(o=t.genes[r],t.genes[r]=t.genes[i],t.genes[i]=o)):0>n&&r>i&&(s=d3.transform(d3.select(this).attr("transform")).translate[1],s>a&&(o=t.genes[r],t.genes[r]=t.genes[i],t.genes[i]=o))})}),e.on("dragend",function(){t.updateCallback(!0)});var n=d3.selectAll(".row").call(e);n.on("click",function(){d3.event.defaultPrevented})},r.prototype.getY=function(t){var e=this,n=e.genes.map(function(t){return t.id});if(e.heatMap===!0)return e.y(n.indexOf(t.gene));var r=Object.keys(e.colorMap);return e.y(n.indexOf(t.gene))+e.cellHeight/r.length*(r.indexOf(t.consequence)-1)},r.prototype.getColor=function(t){var e=this;return e.heatMap===!0?"#D33682":e.colorMap[t.consequence]},r.prototype.getOpacity=function(){var t=this;return t.heatMap===!0?.3:1},r.prototype.getHeight=function(){var t=this;return t.heatMap===!0?t.cellHeight:t.cellHeight/Object.keys(t.colorMap).length},r.prototype.toggleHeatmap=function(){var t=this;t.heatMap=t.heatMap!==!0,d3.selectAll(".sortable-rect").transition().attr("y",function(e){return t.getY(e)}).attr("height",function(e){return t.getHeight(e)}).attr("fill",function(e){return t.getColor(e)}).attr("opacity",function(e){return t.getOpacity(e)})},r.prototype.getDonorIndex=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.donorId===e)return n}return-1},r.prototype.destroy=function(){var t=this;d3.select(t.element).select(".maingrid-svg").remove(),d3.select(t.element).select(".tooltip-oncogrid").remove()}}(),e.exports=r},{}],3:[function(t,e,n){MainGrid=t("./MainGrid"),OncoHistogram=t("./Histogram");var r;!function(){"use strict";r=function(t){var e=this;e.donors=t.donors||[],e.genes=t.genes||[],e.observations=t.observations||[],e.computeGeneScores(),e.computeScores(),e.sortByScores(),e.mainGrid=new MainGrid(t,e.update(e)),e.charts=[],e.charts.push(e.mainGrid)},r.prototype.render=function(){var t=this;t.charts.forEach(function(t){t.render()})},r.prototype.update=function(t){var e=t;return function(t){t="undefined"==typeof t||null===t?!1:t,t&&(e.computeScores(),e.sortByScores()),e.charts.forEach(function(t){t.update()})}},r.prototype.sortByScores=function(){var t=this;t.donors.sort(t.sortScore)},r.prototype.genesSortbyScores=function(){var t=this;t.genes.sort(t.sortScore)},r.prototype.getDonorIndex=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.donorId===e)return n}return-1},r.prototype.cluster=function(){var t=this;t.computeGeneScores(),t.genesSortbyScores(),t.computeScores(),t.sortByScores(),t.update(t)()},r.prototype.removeDonors=function(t){for(var e=this,n=[],r=0;r<e.donors.length;r++){var o=e.donors[r];t(o)&&(n.push(o.donorId),d3.selectAll("."+o.donorId+"-cell").remove(),d3.selectAll("."+o.donorId+"-bar").remove(),e.donors.splice(r,1),r--)}for(var a=0;a<e.observations.length;a++){var s=e.observations[a];e.donors.indexOf(s.donorId)>=0&&(e.observations.splice(a,1),a--)}e.update(e)()},r.prototype.removeGenes=function(t){for(var e=this,n=[],r=0;r<e.genes.length;r++){var o=e.genes[r];t(o)&&(n.push(o.id),d3.selectAll("."+o.id+"-cell").remove(),e.genes.splice(r,1),r--)}e.update(e)()},r.prototype.sortDonors=function(t){var e=this;e.donors.sort(t),e.update(e)()},r.prototype.toggleHeatmap=function(){var t=this;t.mainGrid.toggleHeatmap()},r.prototype.mutationScore=function(t,e){for(var n=this,r=0;r<n.observations.length;r++){var o=n.observations[r];if(o.donorId===t&&o.gene===e)return 1}return 0},r.prototype.mutationGeneScore=function(t,e){for(var n=this,r=0,o=0;o<n.observations.length;o++){var a=n.observations[o];a.gene===e&&a.gene===e&&r++}return r},r.prototype.computeScores=function(){for(var t=this,e=0;e<t.donors.length;e++){var n=t.donors[e];n.score=0;for(var r=0;r<t.genes.length;r++){var o=t.genes[r];n.score+=t.mutationScore(n.donorId,o.id)*Math.pow(2,t.genes.length+1-r)}}},r.prototype.computeGeneScores=function(){for(var t=this,e=0;e<t.genes.length;e++){var n=t.genes[e];n.score=0;for(var r=0;r<t.donors.length;r++){var o=t.donors[r];n.score+=t.mutationGeneScore(o.donorId,n.id)}}},r.prototype.sortScore=function(t,e){return t.score<e.score?1:t.score>e.score?-1:0},r.prototype.destroy=function(){var t=this;t.charts.forEach(function(t){t.destroy()})}}(),e.exports=r},{"./Histogram":1,"./MainGrid":2}],4:[function(t,e,n){window.OncoGrid=t("./OncoGrid")},{"./OncoGrid":3}]},{},[4]);